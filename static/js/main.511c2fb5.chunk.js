(this.webpackJsonpkDrive=this.webpackJsonpkDrive||[]).push([[0],{84:function(e,t,r){},85:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),c=r(27),s=r.n(c),i=r(23),l=r.n(i),o=r(32),d=r(11),u=r(98),j=r(91),b=r(94),h=r(92),f=r(13),O=r(10),p=r(14),x=r(59),m=(r(72),r(87),r(88),x.a.initializeApp({apiKey:"AIzaSyCxSb1Cye3xekE2YpTKODDaZTecs_oNzaE",authDomain:"authentication-dev-2c851.firebaseapp.com",projectId:"authentication-dev-2c851",storageBucket:"authentication-dev-2c851.appspot.com",messagingSenderId:"831959514644",appId:"1:831959514644:web:da5f29afb35d3d0fe87101",measurementId:"G-B2FTCVVZ8G"})),v=m.auth(),g=m.firestore(),w={folders:g.collection("folders"),files:g.collection("files"),getCurrentTimestamp:x.a.firestore.FieldValue.serverTimestamp,formatDoc:function(e){return Object(p.a)({id:e.id},e.data())}},y=m.storage(),N=r(2),S=Object(a.createContext)();function k(){return Object(a.useContext)(S)}function F(e){var t=e.children,r=Object(a.useState)(),n=Object(d.a)(r,2),c=n[0],s=n[1],i=Object(a.useState)(!0),l=Object(d.a)(i,2),o=l[0],u=l[1];Object(a.useEffect)((function(){return v.onAuthStateChanged((function(e){s(e),u(!1)}))}),[]);var j={currentUser:c,signUp:function(e,t){return v.createUserWithEmailAndPassword(e,t)},signIn:function(e,t){return v.signInWithEmailAndPassword(e,t)},signOut:function(){return v.signOut()},resetPassword:function(e){return v.sendPasswordResetEmail(e)},updateEmail:function(e){return c.updateEmail(e)},updatePassword:function(e){return c.updatePassword(e)}};return Object(N.jsx)(S.Provider,{value:j,children:!o&&t})}var P=r(15),C=r(90),I=function(e){var t=e.children;return Object(N.jsx)(N.Fragment,{children:Object(N.jsx)(C.a,{className:"d-flex align-items-center justify-content-center",style:{minHeight:"100vh"},children:Object(N.jsx)("div",{className:"w-100",style:{maxWidth:"400px"},children:t})})})};function D(){var e=Object(a.useRef)(),t=Object(a.useRef)(),r=Object(a.useRef)(),n=k(),c=n.signUp,s=(n.currentUser,Object(a.useState)("")),i=Object(d.a)(s,2),p=i[0],x=i[1],m=Object(a.useState)(!1),v=Object(d.a)(m,2),g=v[0],w=v[1],y=Object(f.h)();function S(){return(S=Object(o.a)(l.a.mark((function a(n){return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n.preventDefault(),t.current.value===r.current.value){a.next=4;break}return P.b.error("Passwords do not match!",{duration:3e3}),a.abrupt("return");case 4:return a.prev=4,x(""),w(!0),a.next=9,c(e.current.value,t.current.value);case 9:P.b.success("Account created!",{duration:1500}),setTimeout((function(){y.push("/user")}),1500),a.next=16;break;case 13:a.prev=13,a.t0=a.catch(4),P.b.error("Failed to create account.",{duration:4e3});case 16:w(!1);case 17:case"end":return a.stop()}}),a,null,[[4,13]])})))).apply(this,arguments)}return Object(N.jsxs)(I,{children:[Object(N.jsx)(P.a,{}),Object(N.jsx)(u.a,{children:Object(N.jsxs)(u.a.Body,{children:[Object(N.jsx)("h3",{className:"text-center mb-4",children:"Sign Up"}),p&&Object(N.jsx)(j.a,{variant:"danger",children:p}),Object(N.jsxs)(b.a,{onSubmit:function(e){return S.apply(this,arguments)},children:[Object(N.jsxs)(b.a.Group,{id:"email",children:[Object(N.jsx)(b.a.Label,{children:"Email"}),Object(N.jsx)(b.a.Control,{type:"email",ref:e,required:!0})]}),Object(N.jsxs)(b.a.Group,{id:"password",children:[Object(N.jsx)(b.a.Label,{children:"Password"}),Object(N.jsx)(b.a.Control,{type:"password",ref:t,required:!0})]}),Object(N.jsxs)(b.a.Group,{id:"password-confirm",children:[Object(N.jsx)(b.a.Label,{children:"Password Confirmation"}),Object(N.jsx)(b.a.Control,{type:"password",ref:r,required:!0})]}),Object(N.jsx)(h.a,{disabled:g,type:"submit",className:"w-100",children:"Sign Up"})]})]})}),Object(N.jsxs)("div",{className:"w-100 text-center mt-2",children:["Already have an account? ",Object(N.jsx)(O.a,{to:"/signin",children:"Sign In"})]})]})}var E=function(){function e(){return(e=Object(o.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(""),e.prev=1,e.next=4,b();case 4:P.b.success("Signed out!",{duration:1500}),setTimeout((function(){}),1500),h.push("/signin"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),P.b.error("Failed to sign out.",{duration:3e3});case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}var t=Object(a.useState)(""),r=Object(d.a)(t,2),n=r[0],c=r[1],s=k(),i=s.currentUser,b=s.signOut,h=Object(f.h)();return Object(N.jsxs)(I,{children:[Object(N.jsx)(P.a,{}),Object(N.jsx)(u.a,{children:Object(N.jsxs)(u.a.Body,{children:[Object(N.jsx)("h3",{className:"text-center mb-4",children:"Profile"}),n&&Object(N.jsx)(j.a,{variant:"danger",children:n}),Object(N.jsx)("strong",{children:"Email:"})," ",i.email,Object(N.jsx)(O.a,{to:"/update-profile",className:"btn btn-info w-100 mt-3",children:"Update Profile"}),Object(N.jsx)(O.a,{to:"/",className:"btn btn-primary w-100 mt-3",children:"Back to Dashboard"}),Object(N.jsx)(O.a,{to:"",className:"btn btn-outline-danger w-100 mt-3",onClick:function(){return e.apply(this,arguments)},children:"Sign Out"})]})}),Object(N.jsx)("div",{className:"w-100 text-center mt-2"})]})};function U(){var e=Object(a.useRef)(),t=Object(a.useRef)(),r=k().signIn,n=Object(a.useState)(""),c=Object(d.a)(n,2),s=c[0],i=c[1],p=Object(a.useState)(!1),x=Object(d.a)(p,2),m=x[0],v=x[1],g=Object(f.h)();function w(){return(w=Object(o.a)(l.a.mark((function a(n){return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n.preventDefault(),a.prev=1,i(""),v(!0),a.next=6,r(e.current.value,t.current.value);case 6:P.b.success("Signed in!",{duration:1500}),setTimeout((function(){g.push("/"),v(!1)}),1500),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(1),P.b.error("Failed to sign in.",{duration:3e3});case 13:v(!1);case 14:case"end":return a.stop()}}),a,null,[[1,10]])})))).apply(this,arguments)}return Object(N.jsxs)(I,{children:[Object(N.jsx)(P.a,{}),Object(N.jsxs)("h1",{className:"text-center mb-5 title",children:[Object(N.jsxs)("span",{className:"emphasis",children:[Object(N.jsx)("i",{class:"fas fa-code title-logo"})," k"]}),"Drive"]}),Object(N.jsx)(u.a,{children:Object(N.jsxs)(u.a.Body,{children:[Object(N.jsx)("h3",{className:"text-center mb-4",children:"Sign In"}),s&&Object(N.jsx)(j.a,{variant:"danger",children:s}),Object(N.jsxs)(b.a,{onSubmit:function(e){return w.apply(this,arguments)},children:[Object(N.jsxs)(b.a.Group,{id:"email",children:[Object(N.jsx)(b.a.Label,{children:"Email"}),Object(N.jsx)(b.a.Control,{type:"email",ref:e,required:!0})]}),Object(N.jsxs)(b.a.Group,{id:"password",children:[Object(N.jsx)(b.a.Label,{children:"Password"}),Object(N.jsx)(b.a.Control,{type:"password",ref:t,required:!0})]}),Object(N.jsx)(h.a,{disabled:m,type:"submit",className:"w-100",children:"Sign In"})]}),Object(N.jsx)("div",{className:"w-100 text-center mt-4",children:Object(N.jsx)(O.a,{to:"/reset",children:"Forgot password?"})})]})}),Object(N.jsxs)("div",{className:"w-100 text-center mt-2",children:["Don't have an account? ",Object(N.jsx)(O.a,{to:"/signup",children:"Sign Up"})]})]})}var B=r(66),R=function(e){var t=e.component,r=Object(B.a)(e,["component"]),a=k().currentUser;return Object(N.jsx)(f.c,Object(p.a)(Object(p.a)({},r),{},{render:function(e){return a?Object(N.jsx)(t,Object(p.a)({},e)):Object(N.jsx)(f.b,{to:"/signin"})}}))};function L(){var e=Object(a.useRef)(),t=k().resetPassword,r=Object(a.useState)(""),n=Object(d.a)(r,2),c=n[0],s=n[1],i=Object(a.useState)(!1),p=Object(d.a)(i,2),x=p[0],m=p[1];Object(f.h)();function v(){return(v=Object(o.a)(l.a.mark((function r(a){return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a.preventDefault(),r.prev=1,s(""),m(!0),r.next=6,t(e.current.value);case 6:P.b.success("Password reset e-mail has been sent!",{duration:4e3}),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(1),s("Please double check the E-mail address.");case 12:m(!1);case 13:case"end":return r.stop()}}),r,null,[[1,9]])})))).apply(this,arguments)}return Object(N.jsxs)(I,{children:[Object(N.jsx)(P.a,{}),Object(N.jsx)(u.a,{children:Object(N.jsxs)(u.a.Body,{children:[Object(N.jsx)("h3",{className:"text-center mb-4",children:"Reset Password"}),c&&Object(N.jsx)(j.a,{variant:"danger",children:c}),Object(N.jsxs)(b.a,{onSubmit:function(e){return v.apply(this,arguments)},children:[Object(N.jsxs)(b.a.Group,{id:"email",children:[Object(N.jsx)(b.a.Label,{children:"Email"}),Object(N.jsx)(b.a.Control,{type:"email",ref:e,required:!0})]}),Object(N.jsx)(h.a,{disabled:x,type:"submit",className:"w-100",children:"Reset Password"})]}),Object(N.jsx)("div",{className:"w-100 text-center mt-4",children:Object(N.jsx)(O.a,{to:"/signin",children:"Sign In"})})]})}),Object(N.jsxs)("div",{className:"w-100 text-center mt-2",children:["Don't have an account? ",Object(N.jsx)(O.a,{to:"/signup",children:"Sign Up"})]})]})}function G(){var e=Object(a.useRef)(),t=Object(a.useRef)(),r=Object(a.useRef)(),n=k(),c=n.currentUser,s=n.updateEmail,i=n.updatePassword,l=Object(a.useState)(""),o=Object(d.a)(l,2),p=o[0],x=o[1],m=Object(a.useState)(!1),v=Object(d.a)(m,2),g=v[0],w=v[1],y=Object(f.h)();return Object(N.jsxs)(I,{children:[Object(N.jsx)(P.a,{}),Object(N.jsx)(u.a,{children:Object(N.jsxs)(u.a.Body,{children:[Object(N.jsx)("h3",{className:"text-center mb-4",children:"Update Profile"}),p&&Object(N.jsx)(j.a,{variant:"danger",children:p}),Object(N.jsxs)(b.a,{onSubmit:function(a){if(a.preventDefault(),t.current.value===r.current.value){var n=[];x(""),w(!0),e.current.Value!==c.email&&n.push(s(e.current.value)),t.current.value&&n.push(i(t.current.value)),Promise.all(n).then((function(){P.b.success("Profile successfully updated!",{duration:1500}),setTimeout((function(){y.push("/user"),w(!1)}),1500)})).catch((function(){P.b.error("Profile update failed.",{duration:4e3})})).finally((function(){}))}else P.b.error("Passwords do not match!",{duration:3e3})},children:[Object(N.jsxs)(b.a.Group,{id:"email",children:[Object(N.jsx)(b.a.Label,{children:"Email"}),Object(N.jsx)(b.a.Control,{type:"email",ref:e,required:!0,defaultValue:c.email})]}),Object(N.jsxs)(b.a.Group,{id:"password",children:[Object(N.jsx)(b.a.Label,{children:"Password"}),Object(N.jsx)(b.a.Control,{type:"password",ref:t,placeholder:"Leave blank to keep the same password"})]}),Object(N.jsxs)(b.a.Group,{id:"password-confirm",children:[Object(N.jsx)(b.a.Label,{children:"Password Confirmation"}),Object(N.jsx)(b.a.Control,{type:"password",ref:r,placeholder:"Leave blank to keep the same password"})]}),Object(N.jsx)(h.a,{disabled:g,type:"submit",className:"w-100",children:"Update"})]})]})}),Object(N.jsx)("div",{className:"w-100 text-center mt-2",children:Object(N.jsx)(O.a,{to:"/user",children:"Go back"})})]})}var A="select-folder",T="update-folder",W="set-child-folders",q="set-child-files",V={name:"Root",id:null,path:[]},z=function(e,t){var r=t.type,a=t.payload;switch(r){case A:return{folderId:a.folderId,folder:a.folder,childFiles:[],childFolders:[]};case T:return Object(p.a)(Object(p.a)({},e),{},{folder:a.folder});case W:return Object(p.a)(Object(p.a)({},e),{},{childFolders:a.childFolders});case q:return Object(p.a)(Object(p.a)({},e),{},{childFiles:a.childFiles});default:return e}};var H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=Object(a.useReducer)(z,{folderId:e,folder:t,childFolders:[],childFiles:[]}),n=Object(d.a)(r,2),c=n[0],s=n[1],i=k(),l=i.currentUser;return Object(a.useEffect)((function(){s({type:A,payload:{folderId:e,folder:t}})}),[e,t]),Object(a.useEffect)((function(){if(null==e)return s({type:T,payload:{folder:V}});w.folders.doc(e).get().then((function(e){s({type:T,payload:{folder:w.formatDoc(e)}}),console.log(w.formatDoc(e))})).catch((function(e){console.error(e),s({type:T,payload:{folder:V}})}))}),[e]),Object(a.useEffect)((function(){return w.folders.where("parentFolderId","==",e).where("owner","==",l.uid).orderBy("createdAt").onSnapshot((function(e){s({type:W,payload:{childFolders:e.docs.map(w.formatDoc)}})}))}),[e,l]),Object(a.useEffect)((function(){return w.files.where("folderId","==",e).where("owner","==",l.uid).onSnapshot((function(e){s({type:q,payload:{childFiles:e.docs.map(w.formatDoc)}})}))}),[e,l]),c},_=r(39),J=r(93),K=function(e){var t=e.currentFolder,r=Object(a.useState)(!1),n=Object(d.a)(r,2),c=n[0],s=n[1],i=Object(a.useState)(""),l=Object(d.a)(i,2),o=l[0],u=l[1],j=k().currentUser,f=function(){s(!c)};return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsxs)(h.a,{onClick:f,variant:"outline-success",size:"sm",children:[Object(N.jsx)("i",{className:"fas fa-folder-plus"})," Create New Folder"]}),Object(N.jsx)(J.a,{show:c,onHide:f,children:Object(N.jsxs)(b.a,{onSubmit:function(e){if(e.preventDefault(),null!=t){var r=Object(_.a)(t.path);t!==V&&r.push({name:t.name,id:t.id}),w.folders.add({name:o,parentFolderId:t.id,owner:j.uid,path:r,createdAt:w.getCurrentTimestamp()}),u(""),f()}},children:[Object(N.jsx)(J.a.Body,{children:Object(N.jsxs)(b.a.Group,{children:[Object(N.jsx)(b.a.Label,{children:"Folder Name"}),Object(N.jsx)(b.a.Control,{type:"text",value:o,onChange:function(e){return u(e.target.value)},required:!0})]})}),Object(N.jsxs)(J.a.Footer,{children:[Object(N.jsx)(h.a,{variant:"secondary",onClick:f,children:"Close"}),Object(N.jsx)(h.a,{variant:"success",type:"submit",children:"Add Folder"})]})]})})]})},M=function(e){var t=e.folder;return Object(N.jsxs)(h.a,{to:{pathname:"/folder/".concat(t.id),state:{folder:t}},variant:"outline-warning",style:{maxWidth:150},className:"text-truncate",as:O.a,children:[Object(N.jsx)("i",{class:"fas fa-folder"})," ",t.name]})},Z=r(96),Y=r(95),Q=function(){return Object(N.jsxs)(Z.a,{bg:"light",expand:"lg",children:[Object(N.jsxs)(Z.a.Brand,{as:O.a,to:"",children:[Object(N.jsxs)("span",{className:"emphasis",children:[Object(N.jsx)("i",{className:"fas fa-code title-logo"})," k"]}),"Drive"]}),Object(N.jsx)(Y.a,{className:"ml-auto",children:Object(N.jsxs)(Y.a.Link,{as:O.a,to:"/user",className:"btn btn-outline-secondary p-2",children:[Object(N.jsx)("i",{class:"fas fa-user"})," Profile"]})})]})},X=r(99),$=function(e){var t=e.currentFolder,r=t===V?[]:[V];return t&&(r=[].concat(Object(_.a)(r),Object(_.a)(t.path))),Object(N.jsxs)(X.a,{className:"flex-grow-1 m-0",listProps:{className:"bg-white pl-0 m-0"},children:[r.map((function(e,t){return Object(N.jsx)(X.a.Item,{className:"text-truncate d-inline-block",style:{maxWidth:150},linkAs:O.a,linkProps:{to:{pathname:e.id?"/folder/".concat(e.id):"/",state:{folder:Object(p.a)(Object(p.a)({},e),{},{path:r.slice(1,t)})}}},children:e.name},e.id)})),t&&Object(N.jsx)(X.a.Item,{className:"text-truncate d-inline-block",style:{maxWidth:200},active:!0,children:t.name})]})},ee=r(65),te=r(97),re=r(100),ae=function(e){var t=e.currentFolder,r=Object(a.useState)([]),n=Object(d.a)(r,2),c=n[0],i=n[1],l=k().currentUser;return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsxs)("label",{className:"btn btn-outline-success btn-sm m-0 mr-2",children:[Object(N.jsx)("i",{class:"fas fa-cloud-upload-alt"})," Upload File",Object(N.jsx)("input",{type:"file",onChange:function(e){var r=e.target.files[0];if(null!=t&&null!=r){var a=Object(ee.uuid)();i((function(e){return[].concat(Object(_.a)(e),[{id:a,name:r.name,progress:0,error:!1}])}));var n=t===V?"".concat(t.path.map((function(e){return e.name})).join("/"),"/").concat(r.name):"".concat(t.path.map((function(e){return e.name})).join("/"),"/").concat(t.name,"/").concat(r.name),c=y.ref("/files/".concat(l.uid,"/").concat(n)).put(r);c.on("state_changed",(function(e){var t=e.bytesTransferred/e.totalBytes;i((function(e){return e.map((function(e){return e.id===a?Object(p.a)(Object(p.a)({},e),{},{progress:t}):e}))}))}),(function(){i((function(e){return e.map((function(e){return e.id===a?Object(p.a)(Object(p.a)({},e),{},{error:!0}):e}))}))}),(function(){i((function(e){return e.filter((function(e){return e.id!==a}))})),c.snapshot.ref.getDownloadURL().then((function(e){w.files.where("name","==",r.name).where("owner","==",l.uid).where("folderId","==",t.id).get().then((function(a){var n=a.docs[0];n?n.ref.update({url:e}):w.files.add({url:e,name:r.name,createdAt:w.getCurrentTimestamp(),folderId:t.id,owner:l.uid})}))}))}))}},style:{opacity:0,display:"none"}})]}),c.length>0&&s.a.createPortal(Object(N.jsx)("div",{style:{position:"absolute",bottom:"1rem",right:"1rem",maxWidth:250},children:c.map((function(e){return Object(N.jsxs)(te.a,{onClose:function(){i((function(t){return t.filter((function(t){return t.id!==e.id}))}))},children:[Object(N.jsx)(te.a.Header,{className:"text-truncate w-100 d-block",closeButton:e.error,children:e.name}),Object(N.jsx)(te.a.Body,{children:Object(N.jsx)(re.a,{animated:!e.error,variant:e.error?"danger":"primary",now:e.error?100:100*e.progress,label:e.error?"Error":"".concat(Math.round(100*e.progress),"%")})})]},e.id)}))}),document.body)]})},ne=function(e){var t=e.file;return Object(N.jsxs)("a",{href:t.url,target:"_blank",style:{maxWidth:200},className:"btn btn-outline-primary text-truncate",children:[Object(N.jsx)("i",{class:"fas fa-file-alt"})," ",t.name]})},ce=function(){var e=Object(f.j)().folderId,t=Object(f.i)().state,r=H(e,(void 0===t?{}:t).folder),a=r.folder,n=r.childFolders,c=r.childFiles;return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(Q,{}),Object(N.jsxs)(C.a,{fluid:!0,children:[Object(N.jsxs)("div",{className:"d-flex align-items-center pb-4",children:["\ud83d\udcc1\xa0",Object(N.jsx)($,{currentFolder:a}),Object(N.jsx)(ae,{currentFolder:a}),Object(N.jsx)(K,{currentFolder:a})]}),n.length>0&&Object(N.jsx)("div",{classname:"d-flex flex-wrap",style:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:n.map((function(e){return Object(N.jsx)("div",{style:{maxWidth:250},className:"p-2",children:Object(N.jsx)(M,{folder:e})},e.id)}))}),n.length>0&&c.length>0&&Object(N.jsx)("hr",{}),c.length>0&&Object(N.jsx)("div",{classname:"d-flex flex-wrap",style:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:c.map((function(e){return Object(N.jsx)("div",{style:{maxWidth:250},className:"p-2",children:Object(N.jsx)(ne,{file:e})},e.id)}))})]})]})};var se=function(){return Object(N.jsx)(f.a,{basename:"/kDrive",children:Object(N.jsx)(F,{children:Object(N.jsxs)(f.e,{children:[Object(N.jsx)(R,{exact:!0,path:"/",component:ce}),Object(N.jsx)(R,{exact:!0,path:"/folder/:folderId",component:ce}),Object(N.jsx)(R,{path:"/user",component:E}),Object(N.jsx)(R,{path:"/update-profile",component:G}),Object(N.jsx)(f.c,{path:"/signup",component:D}),Object(N.jsx)(f.c,{path:"/signin",component:U}),Object(N.jsx)(f.c,{path:"/reset",component:L})]})})})};r(83),r(84);s.a.render(Object(N.jsx)(n.a.StrictMode,{children:Object(N.jsx)(se,{})}),document.getElementById("root"))}},[[85,1,2]]]);
//# sourceMappingURL=main.511c2fb5.chunk.js.map